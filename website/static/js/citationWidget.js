/**
 * Controller for the rich citation widget on the project overview page.
 */
'use strict';

var $ = require('jquery');
var Raven = require('raven-js');
require('select2');

var $osf = require('./osfHelpers');
var citations = require('./citations');

require('../css/citations_widget.css');

var ctx = window.contextVars;

var formatResult = function(state) {
    return '<div class="citation-result-title">' + state.title + '</div>';
};

var formatSelection = function(state) {
    return state.title;
};

// Public API

function CitationWidget(inputSelector, displaySelector) {
    this.$input = $(inputSelector || '#citationStyleInput');
    this.$citationElement = $(displaySelector || '#citationText');
    this.init();
}


var styleIds = ['academy-of-management-review', 'acm-sig-proceedings', 'acm-sig-proceedings-long-author-list', 'acm-sigchi-proceedings', 'acm-sigchi-proceedings-extended-abstract-format', 'acm-siggraph', 'acs-nano', 'acta-anaesthesiologica-scandinavica', 'acta-anaesthesiologica-taiwanica', 'acta-materialia', 'acta-naturae', 'acta-neurochirurgica', 'acta-ophthalmologica', 'acta-palaeontologica-polonica', 'acta-pharmaceutica', 'acta-pharmaceutica-sinica-b', 'acta-philosophica', 'acta-polytechnica', 'acta-psychiatrica-scandinavica', 'acta-societatis-botanicorum-poloniae', 'acta-universitatis-agriculturae-sueciae', 'administrative-science-quarterly', 'advanced-engineering-materials', 'advanced-functional-materials', 'advanced-materials', 'advances-in-alzheimers-disease', 'advances-in-complex-systems', 'african-journal-of-emergency-medicine', 'african-zoology', 'aging-cell', 'aids', 'alexandria-journal-of-medicine', 'allergology-international', 'allergy', 'alternatives-to-animal-experimentation', 'ambio', 'ameghiniana', 'american-anthropological-association', 'american-association-for-cancer-research', 'american-association-of-petroleum-geologists', 'american-chemical-society', 'american-chemical-society-author-date', 'american-chemical-society-page-first', 'american-chemical-society-with-titles', 'american-chemical-society-with-titles-no-et-al', 'american-chemical-society-with-titles-page-first', 'american-chemical-society-with-titles-sentence-case', 'american-chemical-society-with-titles-sentence-case-doi', 'american-fisheries-society', 'american-geophysical-union', 'american-heart-association', 'american-institute-of-aeronautics-and-astronautics', 'american-institute-of-physics', 'american-journal-of-agricultural-economics', 'american-journal-of-archaeology', 'american-journal-of-botany', 'american-journal-of-clinical-pathology', 'american-journal-of-epidemiology', 'american-journal-of-health-behavior', 'american-journal-of-human-genetics', 'american-journal-of-medical-genetics', 'american-journal-of-neuroradiology', 'american-journal-of-orthodontics-and-dentofacial-orthopedics', 'american-journal-of-plant-sciences', 'american-journal-of-political-science', 'american-journal-of-primatology', 'american-journal-of-respiratory-and-critical-care-medicine', 'american-journal-of-surgical-pathology', 'american-marketing-association', 'american-medical-association', 'american-medical-association-alphabetical', 'american-medical-association-no-et-al', 'american-medical-association-no-url', 'american-meteorological-society', 'american-mineralogist', 'american-physics-society', 'american-physiological-society', 'american-phytopathological-society', 'american-phytopathological-society-numeric', 'american-political-science-association', 'american-society-for-microbiology', 'american-society-for-pharmacology-and-experimental-therapeutics', 'american-society-of-civil-engineers', 'american-society-of-mechanical-engineers', 'american-sociological-association', 'american-veterinary-medical-association', 'anesthesia-and-analgesia', 'anesthesiology', 'angewandte-chemie', 'angiologia', 'annalen-des-naturhistorischen-museums-in-wien', 'annales', 'annals-of-applied-biology', 'annals-of-biomedical-engineering', 'annals-of-botany', 'annals-of-neurology', 'annals-of-oncology', 'annals-of-the-association-of-american-geographers', 'annual-review-of-astronomy-and-astrophysics', 'annual-review-of-medicine', 'annual-review-of-nuclear-and-particle-science', 'annual-reviews', 'annual-reviews-alphabetical', 'annual-reviews-author-date', 'annual-reviews-without-titles', 'antarctic-science', 'anticancer-research', 'antiquity', 'apa', 'apa-5th-edition', 'apa-annotated-bibliography', 'apa-cv', 'apa-fr-provost', 'apa-fr-universite-de-montreal', 'apa-no-ampersand', 'apa-no-doi-no-issue', 'apa-single-spaced', 'apa-tr', 'applied-spectroscopy', 'aquatic-conservation', 'aquatic-living-resources', 'arachne', 'arachnology', 'archaeometry', 'archeologie-medievale', 'archiv-fur-die-civilistische-praxis', 'archiv-fur-geschichte-der-philosophie', 'archives-of-oral-biology', 'archives-of-physical-medicine-and-rehabilitation', 'art-history', 'artery-research', 'arthritis-and-rheumatism', 'arzneimitteltherapie', 'asa-cssa-sssa', 'asaio-journal', 'asia-and-the-pacific-policy-studies', 'asian-studies-review', 'associacao-brasileira-de-normas-tecnicas', 'associacao-brasileira-de-normas-tecnicas-ipea', 'associacao-brasileira-de-normas-tecnicas-note', 'associacao-brasileira-de-normas-tecnicas-ufjf', 'associacao-brasileira-de-normas-tecnicas-ufmg-face-full', 'associacao-brasileira-de-normas-tecnicas-ufmg-face-initials', 'associacao-brasileira-de-normas-tecnicas-ufpr', 'associacao-brasileira-de-normas-tecnicas-usp-fmvz', 'associacao-nacional-de-pesquisa-e-ensino-em-transportes', 'association-for-computational-linguistics', 'association-for-computing-machinery', 'atencion-primaria', 'ausonius-editions', 'austral-ecology', 'australasian-emergency-nursing-journal', 'australian-critical-care', 'australian-guide-to-legal-citation', 'australian-historical-studies', 'australian-journal-of-earth-sciences', 'australian-journal-of-grape-and-wine-research', 'australian-veterinary-journal', 'austrian-legal', 'avian-conservation-and-ecology', 'avian-diseases', 'avian-pathology', 'aviation-space-and-environmental-medicine', 'babes-bolyai-university-faculty-of-orthodox-theology', 'beltz-padagogik', 'bibtex', 'bioarchaeology-of-the-near-east', 'biochemical-journal', 'biochemical-society-transactions', 'biochemistry', 'biochimica-et-biophysica-acta', 'bioelectromagnetics', 'bioessays', 'bioinformatics', 'biological-journal-of-the-linnean-society', 'biological-psychiatry', 'biological-reviews', 'biology-of-reproduction', 'biomed-central', 'biomed-research-international', 'biometrics', 'bioorganic-and-medicinal-chemistry-letters', 'biophysical-journal', 'biotechniques', 'biotechnology-and-bioengineering', 'biotropica', 'blood', 'bluebook-inline', 'bluebook-law-review', 'bluebook2', 'bmj', 'body-and-society', 'boreal-environment-research', 'brain', 'brazilian-journal-of-infectious-diseases', 'briefings-in-bioinformatics', 'british-ecological-society', 'british-journal-of-anaesthesia', 'british-journal-of-cancer', 'british-journal-of-dermatology', 'british-journal-of-haematology', 'british-journal-of-industrial-relations', 'british-journal-of-pharmacology', 'british-journal-of-political-science', 'british-journal-of-surgery', 'building-structure', 'bulletin-de-la-societe-prehistorique-francaise', 'bulletin-of-faculty-of-pharmacy-cairo-university', 'bulletin-of-marine-science', 'byzantina-symmeikta', 'cahiers-du-centre-gustave-glotz', 'campus-adventiste-du-saleve-faculte-adventiste-de-theologie', 'canadian-journal-of-dietetic-practice-and-research', 'canadian-journal-of-fisheries-and-aquatic-sciences', 'canadian-public-policy', 'carbohydrate-research', 'carcinogenesis', 'cardiocore', 'catholic-biblical-association', 'cell', 'cell-numeric', 'cell-research', 'cell-transplantation', 'cellular-and-molecular-bioengineering', 'cellular-reprogramming', 'centaurus', 'centre-de-recherche-sur-les-civilisations-de-l-asie-orientale', 'cerebral-cortex', 'chemical-senses', 'chest', 'chicago-annotated-bibliography', 'chicago-author-date', 'chicago-author-date-basque', 'chicago-author-date-de', 'chicago-author-date-fr', 'chicago-figures', 'chicago-fullnote-bibliography', 'chicago-fullnote-bibliography-fr', 'chicago-fullnote-bibliography-no-ibid', 'chicago-library-list', 'chicago-note-biblio-no-ibid', 'chicago-note-bibliography', 'chinese-gb7714-1987-numeric', 'chinese-gb7714-2005-author-date', 'chinese-gb7714-2005-numeric', 'chinese-journal-of-aeronautics', 'chroniques-des-activites-archeologiques-de-l-ecole-francaise-de-rome', 'circulation', 'cirugia-cardiovascular', 'cirugia-espanola', 'clay-minerals', 'clays-and-clay-minerals', 'clinica-e-investigacion-en-arteriosclerosis', 'clinical-infectious-diseases', 'clinical-nuclear-medicine', 'clinical-orthopaedics-and-related-research', 'clinical-otolaryngology', 'clinical-pharmacology-and-therapeutics', 'clio-medica', 'cns-and-neurological-disorders-drug-targets', 'cold-spring-harbor-laboratory-press', 'collection-du-centre-jean-berard', 'collections-electroniques-de-l-inha-author-date', 'collections-electroniques-de-l-inha-full-note', 'colombian-journal-of-anesthesiology', 'comision-economica-para-america-latina-y-el-caribe', 'complementary-therapies-in-medicine', 'computer-und-recht', 'conservation-biology', 'conservation-letters', 'conservation-physiology', 'copernicus-publications', 'coral-reefs', 'corrosion', 'council-of-science-editors', 'council-of-science-editors-alphabetical', 'council-of-science-editors-author-date', 'cranfield-university-numeric', 'critical-care-medicine', 'cuadernos-de-filologia-clasica', 'culture-medicine-and-psychiatry', 'current-opinion', 'current-proteomics', 'current-protocols', 'currents-in-biblical-research', 'cytometry', 'database', 'de-buck', 'decision-sciences', 'der-moderne-staat', 'deutsche-gesellschaft-fur-psychologie', 'deutsche-medizinische-wochenschrift', 'deutsche-sprache', 'deutsches-archaologisches-institut', 'diagnostico-prenatal', 'dialisis-y-trasplante', 'diatom-research', 'die-bachelorarbeit-samac-et-al-in-text', 'die-bachelorarbeit-samac-et-al-note', 'din-1505-2', 'din-1505-2-alphanumeric', 'din-1505-2-numeric', 'din-1505-2-numeric-alphabetical', 'diplo', 'disability-and-rehabilitation', 'dna-research', 'documents-d-archeologie-francaise', 'drug-development-research', 'drug-testing-and-analysis', 'drugs-of-today', 'ear-and-hearing', 'early-medieval-europe', 'earth-surface-processes-and-landforms', 'ecological-entomology', 'ecology', 'ecology-and-society', 'ecology-letters', 'economic-commission-for-latin-america-and-the-caribbean', 'economie-et-statistique', 'ecoscience', 'ecosystems', 'el-profesional-de-la-informacion', 'elsevier-harvard', 'elsevier-harvard-without-titles', 'elsevier-harvard2', 'elsevier-vancouver', 'elsevier-with-titles', 'elsevier-with-titles-alphabetical', 'elsevier-without-titles', 'embo-reports', 'emerald-harvard', 'emu-austral-ornithology', 'endocrine-press', 'endocrinologia-y-nutricion', 'engineering-in-life-sciences', 'ens-de-lyon-centre-d-ingenierie-documentaire', 'entomologia-experimentalis-et-applicata', 'entomological-society-of-america', 'environment-and-planning', 'environmental-and-engineering-geoscience', 'environmental-chemistry', 'environmental-conservation', 'environmental-health-perspectives', 'environmental-microbiology', 'environmental-toxicology-and-chemistry', 'epidemiologie-et-sante-animale', 'equine-veterinary-education', 'equine-veterinary-journal', 'ergoscience', 'ethics-book-reviews', 'ethnobiology-and-conservation', 'ets-ecole-de-technologie-superieure', 'european-cells-and-materials', 'european-journal-of-clinical-microbiology-and-infectious-diseases', 'european-journal-of-emergency-medicine', 'european-journal-of-human-genetics', 'european-journal-of-immunology', 'european-journal-of-information-systems', 'european-journal-of-neuroscience', 'european-journal-of-ophthalmology', 'european-journal-of-paediatric-neurology', 'european-journal-of-pain', 'european-journal-of-political-research', 'european-journal-of-soil-science', 'european-journal-of-surgical-oncology', 'european-journal-of-vascular-and-endovascular-surgery', 'european-respiratory-journal', 'european-retail-research', 'european-society-of-cardiology', 'european-union-interinstitutional-style-guide', 'evolution', 'evolution-and-development', 'evolutionary-anthropology', 'evolutionary-ecology-research', 'exercer', 'experimental-dermatology', 'eye', 'fachhochschule-kiel-fachbereich-medien', 'fachhochschule-vorarlberg', 'facial-plastic-surgery-clinics-of-north-america', 'federation-of-european-microbiological-societies', 'fertility-and-sterility', 'finanzarchiv', 'first-monday', 'fish-and-fisheries', 'flavour-and-fragrance-journal', 'foerster-geisteswissenschaft', 'fold-and-r', 'forensic-science-review', 'forest-science', 'free-radical-biology-and-medicine', 'free-radical-research', 'freie-universitat-berlin-geographische-wissenschaften', 'french-politics', 'french1', 'french2', 'french3', 'french4', 'freshwater-biology', 'freshwater-science', 'frontiers', 'frontiers-in-ecology-and-the-environment', 'frontiers-in-optics', 'frontiers-in-physics', 'frontiers-medical-journals', 'future-science-group', 'g3', 'gallia', 'gastroenterology', 'gastrointestinal-endoscopy-clinics-of-north-america', 'gastrointestinal-intervention', 'geistes-und-kulturwissenschaften-heilmann', 'genes-to-cells', 'geneses', 'genetics', 'genetics-and-molecular-biology', 'genome-biology-and-evolution', 'geoarchaeology', 'geochimica-et-cosmochimica-acta', 'geografie-sbornik-cgs', 'geological-magazine', 'geology', 'geopolitics', 'georg-august-universitat-gottingen-institut-fur-ethnologie-und-ethnologische-sammlung', 'gesellschaft-fur-popularmusikforschung', 'gewerblicher-rechtsschutz-und-urheberrecht', 'global-change-biology', 'global-ecology-and-biogeography', 'gost-r-7-0-5-2008', 'gost-r-7-0-5-2008-numeric', 'grasas-y-aceites', 'hamburg-school-of-food-science', 'hand', 'harvard-anglia-ruskin-university', 'harvard-bournemouth-university', 'harvard-cape-peninsula-university-of-technology', 'harvard-cardiff-university', 'harvard-cardiff-university-biosi', 'harvard-cite-them-right', 'harvard-coventry-university', 'harvard-cranfield-university', 'harvard-durham-university-business-school', 'harvard-edge-hill-university', 'harvard-european-archaeology', 'harvard-fachhochschule-salzburg', 'harvard-gesellschaft-fur-bildung-und-forschung-in-europa', 'harvard-imperial-college-london', 'harvard-institut-fur-praxisforschung-de', 'harvard-kings-college-london', 'harvard-leeds-beckett-university', 'harvard-leeds-metropolitan-university', 'harvard-limerick', 'harvard-london-south-bank-university', 'harvard-manchester-business-school', 'harvard-manchester-metropolitan-university', 'harvard-newcastle-university', 'harvard-north-west-university', 'harvard-oxford-brookes-university-faculty-of-health-and-life-sciences', 'harvard-pontificia-universidad-catolica-del-ecuador', 'harvard-southampton-solent-university', 'harvard-staffordshire-university', 'harvard-swinburne-university-of-technology', 'harvard-the-university-of-melbourne', 'harvard-the-university-of-northampton', 'harvard-the-university-of-sheffield-school-of-east-asian-studies', 'harvard-the-university-of-sheffield-town-and-regional-planning', 'harvard-universiti-tunku-abdul-rahman', 'harvard-university-for-the-creative-arts', 'harvard-university-of-abertay-dundee', 'harvard-university-of-birmingham', 'harvard-university-of-brighton-school-of-environment-and-technology', 'harvard-university-of-cape-town', 'harvard-university-of-gloucestershire', 'harvard-university-of-greenwich', 'harvard-university-of-kent', 'harvard-university-of-leeds', 'harvard-university-of-sunderland', 'harvard-university-of-the-west-of-england', 'harvard-university-of-the-west-of-scotland', 'harvard-university-of-west-london', 'harvard-university-of-westminster', 'harvard-university-of-wolverhampton', 'harvard1', 'harvard7de', 'hawaii-international-conference-on-system-sciences-proceedings', 'health-and-social-care-in-the-community', 'health-economics-policy-and-law', 'health-policy-and-planning', 'health-services-research', 'heart-failure-clinics', 'heart-rhythm', 'hematology-oncology-clinics-of-north-america', 'hepatology', 'heredity', 'histoire-at-politique', 'histoire-et-mesure', 'history-and-theory', 'history-of-the-human-sciences', 'hochschule-fur-wirtschaft-und-recht-berlin', 'hong-kong-journal-of-radiology', 'human-brain-mapping', 'human-mutation', 'human-pathology', 'human-reproduction', 'human-reproduction-update', 'human-resource-management-journal', 'human-wildlife-interactions', 'hydrobiologia', 'hydrological-sciences-journal', 'hypertension-research', 'hypotheses-in-the-life-sciences', 'ices-journal-of-marine-science', 'ie-comunicaciones', 'ieee', 'ieee-with-url', 'igaku-toshokan', 'iica-catie', 'immunological-reviews', 'indian-journal-of-medical-research', 'indoor-air', 'infectious-disease-clinics-of-north-america', 'inflammatory-bowel-diseases', 'infoclio-de', 'infoclio-fr-nocaps', 'infoclio-fr-smallcaps', 'information-systems-research', 'ingenieria-agricola', 'insectes-sociaux', 'institut-national-de-la-recherche-scientifique-sciences-sociales', 'institut-national-de-sante-publique-du-quebec-napp', 'institut-national-de-sante-publique-du-quebec-topo', 'institute-of-physics-harvard', 'institute-of-physics-numeric', 'inter-research-science-center', 'inter-ro', 'interaction-design-and-architectures', 'interdisziplinare-zeitschrift-fur-technologie-und-lernen', 'international-conference-on-information-systems-development', 'international-journal-of-audiology', 'international-journal-of-cancer', 'international-journal-of-climatology', 'international-journal-of-electronic-commerce', 'international-journal-of-epidemiology', 'international-journal-of-exercise-science', 'international-journal-of-geriatric-psychiatry', 'international-journal-of-gynecology-and-obstetrics', 'international-journal-of-humanoid-robotics', 'international-journal-of-infectious-diseases', 'international-journal-of-lexicography', 'international-journal-of-nuclear-security', 'international-journal-of-obstetric-anesthesia', 'international-journal-of-occupational-medicine-and-environmental-health', 'international-journal-of-oral-and-maxillofacial-surgery', 'international-journal-of-osteopathic-medicine', 'international-journal-of-plant-sciences', 'international-journal-of-radiation-oncology-biology-physics', 'international-journal-of-sports-medicine', 'international-journal-of-wildland-fire', 'international-labour-organization', 'international-microbiology', 'international-organization', 'international-pig-veterinary-society-congress-proceedings', 'international-studies-association', 'international-union-of-crystallography', 'invertebrate-biology', 'investigative-radiology', 'invisu', 'irish-historical-studies', 'iso690-author-date-cs', 'iso690-author-date-en', 'iso690-author-date-es', 'iso690-author-date-fr', 'iso690-author-date-fr-no-abstract', 'iso690-author-date-sk', 'iso690-full-note-sk', 'iso690-note-cs', 'iso690-note-fr', 'iso690-numeric-brackets-cs', 'iso690-numeric-cs', 'iso690-numeric-en', 'iso690-numeric-fr', 'iso690-numeric-lt', 'iso690-numeric-sk', 'israel-medical-association-journal', 'ithaque', 'jacc-cardiovascular-imaging', 'jahrbuch-der-osterreichischen-byzantinischen-gesellschaft', 'jahrbuch-fur-evangelikale-theologie', 'javnost-the-public', 'journal-for-the-history-of-astronomy', 'journal-francais-dophtalmologie', 'journal-of-adolescent-health', 'journal-of-aerosol-medicine-and-pulmonary-drug-delivery', 'journal-of-alzheimers-disease', 'journal-of-analytical-toxicology', 'journal-of-animal-physiology-and-animal-nutrition', 'journal-of-animal-science', 'journal-of-antimicrobial-chemotherapy', 'journal-of-applied-animal-science', 'journal-of-applied-ecology', 'journal-of-applied-entomology', 'journal-of-applied-philosophy', 'journal-of-archaeological-research', 'journal-of-atrial-fibrillation', 'journal-of-avian-biology', 'journal-of-basic-microbiology', 'journal-of-biogeography', 'journal-of-biological-chemistry', 'journal-of-biomedical-materials-research-part-a', 'journal-of-bone-and-mineral-research', 'journal-of-burn-care-and-research', 'journal-of-cardiothoracic-and-vascular-anesthesia', 'journal-of-cellular-and-molecular-medicine', 'journal-of-chemistry-and-chemical-engineering', 'journal-of-child-and-adolescent-psychopharmacology', 'journal-of-chiropractic-medicine', 'journal-of-clinical-oncology', 'journal-of-combinatorics', 'journal-of-common-market-studies', 'journal-of-computational-chemistry', 'journal-of-consumer-research', 'journal-of-crohns-and-colitis', 'journal-of-crohns-and-colitis-supplements', 'journal-of-dental-research', 'journal-of-elections-public-opinion-and-parties', 'journal-of-endodontics', 'journal-of-european-public-policy', 'journal-of-evolutionary-biology', 'journal-of-experimental-botany', 'journal-of-field-ornithology', 'journal-of-finance', 'journal-of-fish-diseases', 'journal-of-food-protection', 'journal-of-forensic-and-legal-medicine', 'journal-of-forensic-sciences', 'journal-of-frailty-and-aging', 'journal-of-genetic-engineering-and-biotechnology', 'journal-of-geriatric-psychiatry-and-neurology', 'journal-of-glaciology', 'journal-of-hearing-science', 'journal-of-hospital-infection', 'journal-of-human-evolution', 'journal-of-hypertension', 'journal-of-industrial-and-engineering-chemistry', 'journal-of-industrial-ecology', 'journal-of-infection', 'journal-of-infectious-diseases', 'journal-of-information-technology', 'journal-of-institutional-and-theoretical-economics', 'journal-of-integrated-omics', 'journal-of-interactive-marketing', 'journal-of-internal-medicine', 'journal-of-international-business-studies', 'journal-of-investigative-dermatology', 'journal-of-lipid-research', 'journal-of-magnetic-resonance-imaging', 'journal-of-mammalogy', 'journal-of-management', 'journal-of-management-information-systems', 'journal-of-medical-genetics', 'journal-of-medical-internet-research', 'journal-of-minimally-invasive-gynecology', 'journal-of-molecular-endocrinology', 'journal-of-morphology', 'journal-of-neurochemistry', 'journal-of-neurological-disorders', 'journal-of-neurophysiology', 'journal-of-neuroscience-and-neuroengineering', 'journal-of-neurosurgery', 'journal-of-neurotrauma', 'journal-of-nutrition', 'journal-of-oral-and-maxillofacial-surgery', 'journal-of-orthopaedic-research', 'journal-of-orthopaedic-trauma', 'journal-of-orthopaedics-trauma-and-rehabilitation', 'journal-of-paleontology', 'journal-of-peptide-science', 'journal-of-perinatal-medicine', 'journal-of-petrology', 'journal-of-pharmacy-and-pharmacology', 'journal-of-phycology', 'journal-of-plant-nutrition-and-soil-science', 'journal-of-pollination-ecology', 'journal-of-psychiatric-and-mental-health-nursing', 'journal-of-psychiatry-and-neuroscience', 'journal-of-retailing', 'journal-of-rheumatology', 'journal-of-roman-archaeology-a', 'journal-of-roman-archaeology-b', 'journal-of-science-and-medicine-in-sport', 'journal-of-separation-science', 'journal-of-shoulder-and-elbow-surgery', 'journal-of-simulation', 'journal-of-sleep-research', 'journal-of-social-archaeology', 'journal-of-spinal-disorders-and-techniques', 'journal-of-strength-and-conditioning-research', 'journal-of-studies-on-alcohol-and-drugs', 'journal-of-the-air-and-waste-management-association', 'journal-of-the-american-academy-of-orthopaedic-surgeons', 'journal-of-the-american-association-of-laboratory-animal-science', 'journal-of-the-american-ceramic-society', 'journal-of-the-american-college-of-cardiology', 'journal-of-the-american-college-of-surgeons', 'journal-of-the-american-society-of-brewing-chemists', 'journal-of-the-american-society-of-nephrology', 'journal-of-the-american-water-resources-association', 'journal-of-the-association-for-information-systems', 'journal-of-the-brazilian-chemical-society', 'journal-of-the-electrochemical-society', 'journal-of-the-royal-anthropological-institute', 'journal-of-thrombosis-and-haemostasis', 'journal-of-transport-geography', 'journal-of-tropical-ecology', 'journal-of-vegetation-science', 'journal-of-vertebrate-paleontology', 'journal-of-veterinary-cardiology', 'journal-of-visualized-experiments', 'journal-of-wildlife-diseases', 'journal-of-zoo-and-wildlife-medicine', 'journal-of-zoology', 'journalistica', 'juristische-schulung', 'juristische-zitierweise', 'karger-journals', 'karger-journals-author-date', 'kidney-international', 'kidney-research-and-clinical-practice', 'kindheit-und-entwicklung', 'knee-surgery-sports-traumatology-arthroscopy', 'kolner-zeitschrift-fur-soziologie-und-sozialpsychologie', 'kommunikation-und-recht', 'korean-journal-of-anesthesiology', 'kritische-ausgabe', 'kth-royal-institute-of-technology-school-of-computer-science-and-communication', 'kth-royal-institute-of-technology-school-of-computer-science-and-communication-sv', 'landes-bioscience-journals', 'language', 'language-in-society', 'latin-american-perspectives', 'law-and-society-review', 'le-mouvement-social', 'le-tapuscrit-author-date', 'le-tapuscrit-note', 'leidraad-voor-juridische-auteurs', 'les-journees-de-la-recherche-avicole', 'les-journees-de-la-recherche-porcine', 'lethaia', 'lettres-et-sciences-humaines-fr', 'leviathan', 'limnology-and-oceanography', 'liver-international', 'lluelles', 'lluelles-lexisnexis', 'london-south-bank-university-numeric', 'macromolecular-reaction-engineering', 'magnetic-resonance-in-medicine', 'magnetic-resonance-materials-in-physics-biology-and-medicine', 'mammal-review', 'manchester-university-press', 'mastozoologia-neotropical', 'mathematics-and-computers-in-simulation', 'mcdonald-institute-monographs', 'mcgill-en', 'mcgill-fr', 'medecine-sciences', 'media-culture-and-society', 'medical-dosimetry', 'medical-history', 'medical-physics', 'medicine-and-science-in-sports-and-exercise', 'melbourne-school-of-theology', 'memorias-do-instituto-oswaldo-cruz', 'metallurgical-and-materials-transactions', 'meteoritics-and-planetary-science', 'methods-in-ecology-and-evolution', 'methods-of-information-in-medicine', 'metropolitiques', 'microbial-drug-resistance', 'microscopy-and-microanalysis', 'middle-east-critique', 'mineralogical-magazine', 'mis-quarterly', 'modern-humanities-research-association', 'modern-humanities-research-association-author-date', 'modern-language-association', 'modern-language-association-6th-edition-note', 'modern-language-association-underline', 'modern-language-association-with-url', 'mohr-siebeck-recht', 'molecular-and-cellular-proteomics', 'molecular-biology-and-evolution', 'molecular-biology-of-the-cell', 'molecular-ecology', 'molecular-metabolism', 'molecular-microbiology', 'molecular-plant-microbe-interactions', 'molecular-psychiatry-letters', 'molecular-therapy', 'moore-theological-college', 'moorlands-college', 'multidisciplinary-digital-publishing-institute', 'multiple-sclerosis-journal', 'mutagenesis', 'mycologia', 'myrmecological-news', 'nano-biomedicine-and-engineering', 'national-archives-of-australia', 'national-library-of-medicine-grant-proposals', 'national-science-foundation-grant-proposals', 'nature', 'nature-neuroscience-brief-communications', 'nature-no-et-al', 'nature-no-superscript', 'nature-publishing-group-vancouver', 'navigation', 'nccr-mediality', 'nephrology-dialysis-transplantation', 'neue-juristische-wochenschrift', 'neuroimaging-clinics-of-north-america', 'neurology', 'neurology-india', 'neurology-psychiatry-and-brain-research', 'neuropsychopharmacology', 'neurorehabilitation-and-neural-repair', 'neuroreport', 'neurosurgery-clinics-of-north-america', 'new-harts-rules-the-oxford-style-guide', 'new-phytologist', 'new-solutions', 'new-testament-studies', 'new-zealand-plant-protection', 'new-zealand-veterinary-journal', 'norma-portuguesa-405', 'northeastern-naturalist', 'nucleic-acids-research', 'obesity', 'occupational-medicine', 'oikos', 'onderstepoort-journal-of-veterinary-research', 'ophthalmology', 'oral-diseases', 'organization', 'organization-science', 'ornitologia-neotropical', 'orthopedic-clinics-of-north-america', 'oryx', 'oscola', 'oscola-no-ibid', 'osterreichische-zeitschrift-fur-politikwissenschaft', 'owbarth-verlag', 'oxford-art-journal', 'oxford-centre-for-mission-studies-harvard', 'oxford-studies-in-ancient-philosophy', 'oxford-studies-on-the-roman-economy', 'oxford-the-university-of-new-south-wales', 'oxford-university-press-humsoc', 'oxford-university-press-scimed-author-date', 'oxford-university-press-scimed-numeric', 'padagogische-hochschule-fachhochschule-nordwestschweiz', 'padagogische-hochschule-heidelberg', 'padagogische-hochschule-vorarlberg', 'pain', 'palaeontologia-electronica', 'palaeontology', 'palaios', 'paleobiology', 'parasitology', 'past-and-present', 'pediatric-allergy-and-immunology', 'pediatric-anesthesia', 'pediatric-blood-and-cancer', 'pediatric-research', 'peerj', 'periodontology-2000', 'permafrost-and-periglacial-processes', 'perspectives-on-politics', 'pharmacoepidemiology-and-drug-safety', 'philippika', 'philosophia-scientiae', 'philosophiques', 'phycological-research', 'phyllomedusa', 'physiological-and-biochemical-zoology', 'pisa-university-press', 'plant-biology', 'plant-pathology', 'plant-physiology', 'plos', 'pnas', 'podzemna-voda', 'polish-legal', 'political-studies', 'politische-vierteljahresschrift', 'pontifical-athenaeum-regina-apostolorum', 'pontifical-biblical-institute', 'pontifical-gregorian-university', 'population', 'population-space-and-place', 'poultry-science', 'pour-reussir-note', 'preslia', 'presses-universitaires-de-rennes', 'primary-care-clinics-in-office-practice', 'proceedings-of-the-royal-society-b', 'proinflow', 'protein-engineering-design-and-selection', 'protein-science', 'proteomics', 'psychiatric-clinics-of-north-america', 'psychiatric-services', 'psychiatry-and-clinical-neurosciences', 'psychiatry-research', 'psychological-medicine', 'psychosomatics', 'public-health-nutrition', 'quaderni-degli-avogadro-colloquia', 'radiographics', 'radiography', 'radiologic-clinics-of-north-america', 'radiology', 'radiopaedia', 'rapid-communications-in-mass-spectrometry', 'reactive-and-functional-polymers', 'reports-of-practical-oncology-and-radiotherapy', 'reproduction', 'reviews-of-modern-physics-with-titles', 'revista-argentina-de-antropologia-biologica', 'revista-brasileira-de-ciencia-do-solo', 'revista-ciencias-tecnicas-agropecuarias', 'revista-de-biologia-tropical', 'revista-de-filologia-espanola', 'revista-fave-seccion-ciencias-agrarias', 'revista-virtual-de-quimica', 'revue-archeologique', 'revue-archeologique-du-centre-de-la-france', 'revue-de-medecine-veterinaire', 'revue-des-nouvelles-technologies-de-l-information', 'revue-dhistoire-moderne-et-contemporaine', 'revue-francaise-de-sociologie', 'rhodora', 'risk-analysis', 'rofo', 'romanian-humanities', 'rose-school', 'rossiiskii-fiziologicheskii-zhurnal-imeni-i-m-sechenova', 'royal-society-of-chemistry', 'rtf-scan', 'sage-harvard', 'sage-vancouver', 'scandinavian-journal-of-infectious-diseases', 'scandinavian-journal-of-work-environment-and-health', 'scandinavian-political-studies', 'science', 'science-translational-medicine', 'science-without-titles', 'seminaire-saint-sulpice-ecole-theologie', 'seminars-in-pediatric-neurology', 'sexual-development', 'sheffield-hallam-university-history', 'sist02', 'small', 'sociedade-brasileira-de-computacao', 'societe-nationale-des-groupements-techniques-veterinaires', 'society-for-american-archaeology', 'society-for-general-microbiology', 'society-for-historical-archaeology', 'society-for-laboratory-automation-and-screening', 'society-of-automotive-engineers-technical-papers-numeric', 'society-of-biblical-literature-fullnote-bibliography', 'socio-economic-review', 'sociology-of-health-and-illness', 'soil-biology-and-biochemistry', 'soil-science-and-plant-nutrition', 'soziale-welt', 'sozialpadagogisches-institut-berlin-walter-may', 'sozialwissenschaften-heilmann', 'soziologie', 'spandidos-publications', 'spanish-legal', 'spectroscopy-letters', 'spie-bios', 'spie-journals', 'spie-proceedings', 'spip-cite', 'springer-basic-author-date', 'springer-basic-author-date-no-et-al', 'springer-basic-brackets', 'springer-basic-brackets-no-et-al', 'springer-basic-brackets-no-et-al-alphabetical', 'springer-fachzeitschriften-medizin-psychologie', 'springer-humanities-author-date', 'springer-humanities-brackets', 'springer-lecture-notes-in-computer-science', 'springer-lecture-notes-in-computer-science-alphabetical', 'springer-mathphys-author-date', 'springer-mathphys-brackets', 'springer-physics-author-date', 'springer-physics-brackets', 'springer-socpsych-author-date', 'springer-socpsych-brackets', 'springer-vancouver', 'springer-vancouver-author-date', 'springer-vancouver-brackets', 'springerprotocols', 'st-patricks-college', 'standards-in-genomic-sciences', 'stavebni-obzor', 'stem-cells', 'stem-cells-and-development', 'strategic-management-journal', 'stroke', 'studia-bas', 'studii-teologice', 'stuttgart-media-university', 'style-manual-australian-government', 'surgical-clinics-of-north-america', 'surgical-neurology-international', 'surgical-pathology-clinics', 'swedish-legal', 'systematic-and-applied-microbiology', 'systematic-biology', 'taylor-and-francis-chicago-author-date', 'taylor-and-francis-chicago-f', 'taylor-and-francis-council-of-science-editors-author-date', 'taylor-and-francis-harvard-x', 'taylor-and-francis-national-library-of-medicine', 'technische-universitat-dresden-medizin', 'technische-universitat-dresden-wirtschaftswissenschaften', 'technische-universitat-munchen-controlling', 'technische-universitat-munchen-unternehmensfuhrung', 'technische-universitat-wien', 'teologia-catalunya', 'terra-nova', 'tgm-wien-diplom', 'the-accounting-review', 'the-american-journal-of-cardiology', 'the-american-journal-of-gastroenterology', 'the-american-journal-of-pathology', 'the-american-journal-of-psychiatry', 'the-american-naturalist', 'the-astrophysical-journal', 'the-auk', 'the-bone-and-joint-journal', 'the-british-journal-of-cardiology', 'the-british-journal-of-psychiatry', 'the-british-journal-of-sociology', 'the-company-of-biologists', 'the-condor', 'the-design-journal', 'the-egyptian-heart-journal', 'the-embo-journal', 'the-faseb-journal', 'the-febs-journal', 'the-geological-society-of-america', 'the-geological-society-of-london', 'the-historical-journal', 'the-holocene', 'the-institute-of-electronics-information-and-communication-engineers', 'the-institution-of-engineering-and-technology', 'the-international-journal-of-developmental-biology', 'the-international-journal-of-psychoanalysis', 'the-isme-journal', 'the-journal-of-adhesive-dentistry', 'the-journal-of-clinical-investigation', 'the-journal-of-comparative-neurology', 'the-journal-of-eukaryotic-microbiology', 'the-journal-of-hellenic-studies', 'the-journal-of-immunology', 'the-journal-of-infection-in-developing-countries', 'the-journal-of-juristic-papyrology', 'the-journal-of-neuropsychiatry-and-clinical-neurosciences', 'the-journal-of-neuroscience', 'the-journal-of-pain', 'the-journal-of-peasant-studies', 'the-journal-of-physiology', 'the-journal-of-roman-studies', 'the-journal-of-the-acoustical-society-of-america', 'the-journal-of-the-torrey-botanical-society', 'the-journal-of-urology', 'the-journal-of-wildlife-management', 'the-lancet', 'the-lichenologist', 'the-neuroscientist', 'the-new-england-journal-of-medicine', 'the-oncologist', 'the-open-university-a251', 'the-open-university-harvard', 'the-open-university-m801', 'the-open-university-numeric', 'the-open-university-numeric-superscript', 'the-optical-society', 'the-plant-cell', 'the-plant-journal', 'the-review-of-financial-studies', 'the-rockefeller-university-press', 'the-saudi-journal-for-dental-research', 'the-scandinavian-journal-of-clinical-and-laboratory-investigation', 'the-world-journal-of-biological-psychiatry', 'theologie-und-philosophie', 'theory-culture-and-society', 'thieme-e-journals-vancouver', 'thomson-reuters-legal-tax-and-accounting-australia', 'thrombosis-and-haemostasis', 'tissue-engineering', 'traces', 'traffic', 'traffic-injury-prevention', 'transactions-of-the-american-philological-association', 'transactions-of-the-materials-research-society-of-japan', 'transplantation', 'transportation-research-record', 'tree-physiology', 'trends-journals', 'triangle', 'turabian-fullnote-bibliography', 'u-schylku-starozytnosci', 'ugeskrift-for-laeger', 'ultrasound-in-medicine-and-biology', 'unified-style-linguistics', 'united-nations-conference-on-trade-and-development', 'universidad-evangelica-del-paraguay', 'universidade-de-sao-paulo-instituto-de-matematica-e-estatistica', 'universita-cattolica-del-sacro-cuore', 'universita-di-bologna-lettere', 'universita-pontificia-salesiana', 'universita-pontificia-salesiana-en', 'universita-pontificia-salesiana-es', 'universita-pontificia-salesiana-fr', 'universita-pontificia-salesiana-it', 'universita-pontificia-salesiana-pt-br', 'universitat-bremen-institut-fur-politikwissenschaft', 'universitat-freiburg-geschichte', 'universitat-heidelberg-historisches-seminar', 'universitat-mainz-geographisches-institut', 'universitatsmedizin-gottingen', 'universite-de-liege-histoire', 'universite-de-picardie-jules-verne-ufr-de-medecine', 'universite-de-sherbrooke-faculte-d-education', 'universite-du-quebec-a-montreal', 'universite-laval-departement-dinformation-et-de-communication', 'universite-laval-faculte-de-theologie-et-de-sciences-religieuses', 'universite-libre-de-bruxelles-histoire', 'universiteit-utrecht-onderzoeksgids-geschiedenis', 'university-college-dublin-school-of-history-and-archives', 'university-college-lillebaelt-apa', 'university-college-lillebaelt-harvard', 'university-college-lillebaelt-vancouver', 'university-of-helsinki-faculty-of-theology', 'university-of-south-australia-harvard-2011', 'university-of-south-australia-harvard-2013', 'urban-habitats', 'urban-studies', 'urological-science', 'us-geological-survey', 'user-modeling-and-user-adapted-interaction', 'vancouver', 'vancouver-author-date', 'vancouver-brackets', 'vancouver-brackets-no-et-al', 'vancouver-brackets-only-year-no-issue', 'vancouver-fr-ca', 'vancouver-imperial-college-london', 'vancouver-superscript', 'vancouver-superscript-brackets-only-year', 'vancouver-superscript-only-year', 'veterinary-medicine-austria', 'veterinary-radiology-and-ultrasound', 'veterinary-record', 'vienna-legal', 'vietnam-ministry-of-education-and-training-en', 'vietnam-ministry-of-education-and-training-vi', 'vingtieme-siecle', 'water-environment-research', 'water-science-and-technology', 'weed-science-society-of-america', 'wetlands', 'wheaton-college-phd-in-biblical-and-theological-studies', 'who-europe-harvard', 'who-europe-numeric', 'wiley-vch-books', 'wireless-communications-and-mobile-computing', 'wissenschaftlicher-industrielogistik-dialog', 'world-congress-on-engineering-asset-management', 'world-journal-of-gastroenterology', 'world-mycotoxin-journal', 'world-neurosurgery', 'world-politcs', 'xenotransplantation', 'yeast', 'zastosowania-komputerow-w-elektrotechnice', 'zdravniski-vestnik', 'zeitschrift-fur-deutsche-philologie', 'zeitschrift-fur-internationale-beziehungen', 'zeitschrift-fur-medienwissenschaft', 'zeitschrift-fur-padagogik', 'zeitschrift-fur-soziologie', 'zeitschrift-fur-theologie-und-kirche', 'zeszyty-prawnicze-bas', 'zookeys', 'zoological-journal-of-the-linnean-society', 'zootaxa'];

function letsDoThis() {
    var all_cites = {};
    let count = 0;
    styleIds.forEach(each => {
        var styleUrl = '/static/vendor/bower_components/styles/' + each + '.csl';
        var styleRequest = $.get(styleUrl);
        var citationRequest = $.get(ctx.node.urls.api + 'citation/');
        $.when(styleRequest, citationRequest).done((style, data) => {
            var citeproc = citations.makeCiteproc(style[0], data[0], 'html');
            var items = citeproc.makeBibliography()[1];
            let reg = /<.*?>/g;
            all_cites[each] = items[0].replace(reg, '').replace('↵', '')
            console.log(count)
            count = count + 1;
            if (count >= 1179) {
                console.log(JSON.stringify(all_cites))
            }
        })
    });
}

CitationWidget.prototype.init = function() {
    var self = this;

    // Initialize select2 for selecting citation style
    self.$input.select2({
        allowClear: true,
        formatResult: formatResult,
        formatSelection: formatSelection,
        placeholder: 'Enter citation style (e.g. "APA")',
        minimumInputLength: 1,
        ajax: {
            url: '/api/v1/citations/styles/',
            quietMillis: 200,
            data: function(term, page) {
                return {
                    q: term
                };
            },
            results: function(data, page) {
                return {
                    results: data.styles
                };
            },
            cache: true
        }
    }).on('select2-selecting', function(event) {
        letsDoThis()
        var styleUrl = '/static/vendor/bower_components/styles/' + event.val + '.csl';
        var styleRequest = $.get(styleUrl);
        var citationRequest = $.get(ctx.node.urls.api + 'citation/');
        $.when(styleRequest, citationRequest).done(function(style, data) {
            var citeproc = citations.makeCiteproc(style[0], data[0], 'html');
            var items = citeproc.makeBibliography()[1];
            /* the safety of this was discussed with JIRA ticket OSF-4889 */
            self.$citationElement.html(items[0]).slideDown();
        }).fail(function(jqxhr, status, error) {
            $osf.growl(
                'Citation render failed',
                'The requested citation format generated an error.',
                'danger'
            );
            Raven.captureMessage('Unexpected error when fetching citation', {
                extra: {
                    url: styleUrl,
                    citationStyle: event.val,
                    status: status,
                    error: error
                }
            });
        });
    }).on('select2-removed', function(e) {
        self.$citationElement.slideUp().text();
    });

    self.getAllCitations = function() {
        citations = {};

        console.log(JSON.stringify(citations))
    }
};

module.exports = CitationWidget;
