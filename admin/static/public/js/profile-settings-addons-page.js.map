{"version":3,"sources":["webpack:///../website/static/js/pages/profile-settings-addons-page.js","webpack:///../website/static/js/addonSettings.js?7ebd","webpack:///../website/static/js/addonPermissions.js"],"names":[],"mappings":";;;;;AAAA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,CAAC;;;AAGD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,mDAAmD,6BAA6B,EAAE;AAClF;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA,aAAa,iCAAiC;AAC9C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4CAA4C,YAAY;AACxD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;AC/ID;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;;;;;;;;AC/JA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;;AAE7B;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;;AAEA","file":"profile-settings-addons-page.js","sourcesContent":["'use strict';\n\nvar $ = require('jquery');\nvar ko = require('knockout');\nvar bootbox = require('bootbox');\nvar Raven = require('raven-js');\nrequire('js/osfToggleHeight');\n\nvar $osf = require('js/osfHelpers');\nvar AddonPermissionsTable = require('js/addonPermissions');\nvar addonSettings = require('js/addonSettings');\n\nko.punches.enableAll();\n\n\n// Show capabilities modal on selecting an addon; unselect if user\n// rejects terms\n$('.addon-select').on('change', function() {\n    var that = this;\n    var $that = $(that);\n    if ($that.is(':checked')) {\n        var name = $that.attr('name');\n        var capabilities = $('#capabilities-' + name).html();\n        if (capabilities) {\n            bootbox.confirm({\n                message: capabilities,\n                callback: function(result) {\n                    if (!result) {\n                        $that.attr('checked', false);\n                    }\n                },\n                buttons:{\n                    confirm:{\n                        label:'Confirm'\n                    }\n                }\n        });\n        }\n    }\n});\n\n\nvar checkedOnLoad = $('#selectAddonsForm input:checked');\nvar uncheckedOnLoad = $('#selectAddonsForm input:not(:checked)');\n\n// TODO: Refactor into a View Model\n$('#selectAddonsForm').on('submit', function() {\n\n    var formData = {};\n    $('#selectAddonsForm').find('input').each(function(idx, elm) {\n        var $elm = $(elm);\n        formData[$elm.attr('name')] = $elm.is(':checked');\n    });\n\n    var unchecked = checkedOnLoad.filter('#selectAddonsForm input:not(:checked)');\n\n    var submit = function() {\n        var request = $osf.postJSON('/api/v1/settings/addons/', formData);\n        request.done(function() {\n            checkedOnLoad = $('#selectAddonsForm input:checked');\n            uncheckedOnLoad = $('#selectAddonsForm input:not(:checked)');\n            window.location.reload();\n        });\n        request.fail(function() {\n            var msg = 'Sorry, we had trouble saving your settings. If this persists please contact <a href=\"mailto: support@osf.io\">support@osf.io</a>';\n            bootbox.alert({\n                title: 'Request failed',\n                message: msg,\n                buttons:{\n                    ok:{\n                        label:'Close',\n                        className:'btn-default'\n                    }\n                }\n            });\n        });\n    };\n\n    if(unchecked.length > 0) {\n        var uncheckedText = $.map(unchecked, function(el){\n            return ['<li>', $(el).closest('label').text().trim(), '</li>'].join('');\n        }).join('');\n        uncheckedText = ['<ul>', uncheckedText, '</ul>'].join('');\n        bootbox.confirm({\n            title: 'Are you sure you want to remove the add-ons you have deselected? ',\n            message: uncheckedText,\n            callback: function(result) {\n                if (result) {\n                    submit();\n                } else{\n                    unchecked.each(function(i, el){ $(el).prop('checked', true); });\n                }\n            },\n            buttons:{\n                confirm:{\n                    label:'Remove',\n                    className:'btn-danger'\n                }\n            }\n        });\n    }\n    else {\n        submit();\n    }\n    return false;\n});\n\nvar addonEnabledSettings = window.contextVars.addonEnabledSettings;\nfor (var i=0; i < addonEnabledSettings.length; i++) {\n       var addonName = addonEnabledSettings[i];\n       if (typeof window.contextVars.addonsWithNodes !== 'undefined' && addonName in window.contextVars.addonsWithNodes) {\n           AddonPermissionsTable.init(window.contextVars.addonsWithNodes[addonName].shortName,\n                                      window.contextVars.addonsWithNodes[addonName].fullName);\n   }\n}\n\n$(document).ready(function(){\n    $('.addon-auth-table').osfToggleHeight({height: 140});\n});\n\n/* Before closing the page, Check whether the newly checked addon are updated or not */\n$(window).on('beforeunload',function() {\n    //new checked items but not updated\n    var checked = uncheckedOnLoad.filter('#selectAddonsForm input:checked');\n    //new unchecked items but not updated\n    var unchecked = checkedOnLoad.filter('#selectAddonsForm input:not(:checked)');\n\n    if(unchecked.length > 0 || checked.length > 0) {\n        return 'The changes on addon setting are not submitted!';\n    }\n});\n\n/***************\n* OAuth addons *\n****************/\n\n$('.addon-oauth').each(function(index, elem) {\n    var viewModel = new addonSettings.OAuthAddonSettingsViewModel(\n        $(elem).data('addon-short-name'),\n        $(elem).data('addon-name')\n    );\n    ko.applyBindings(viewModel, elem);\n    viewModel.updateAccounts();\n});\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ../website/static/js/pages/profile-settings-addons-page.js\n ** module id = 0\n ** module chunks = 32\n **/","'use strict';\n\nvar $ = require('jquery');\nvar ko = require('knockout');\nvar bootbox = require('bootbox');\nvar Raven = require('raven-js');\nvar oop = require('js/oop');\n\nvar ConnectedProject = function(data) {\n    var self = this;\n    self.title = data.title;\n    self.id = data.id;\n    self.urls = data.urls;\n};\n\nvar ExternalAccount = oop.defclass({\n    constructor: function(data) {\n        var self = this;\n        self.name = data.display_name;\n        self.id = data.id;\n        self.profileUrl = data.profile_url;\n        self.providerName = data.provider_name;\n\n        self.connectedNodes = ko.observableArray();\n\n        ko.utils.arrayMap(data.nodes, function(item) {\n            self.connectedNodes.push(new ConnectedProject(item));\n        });\n    },\n    _deauthorizeNodeConfirm: function(node) {\n        var self = this;\n        var url = node.urls.deauthorize;\n        var request = $.ajax({\n                url: url,\n                type: 'DELETE'\n            })\n            .done(function(data) {\n                self.connectedNodes.remove(node);\n            })\n            .fail(function(xhr, status, error) {\n                Raven.captureMessage('Error deauthorizing node: ' + node.id, {\n                    url: url,\n                    status: status,\n                    error: error\n                });\n            });\n    },\n    deauthorizeNode: function(node) {\n        var self = this;\n        bootbox.confirm({\n            title: 'Remove addon?',\n            message: 'Are you sure you want to remove the ' + self.providerName + ' authorization from this project?',\n            callback: function(confirm) {\n                if (confirm) {\n                    self._deauthorizeNodeConfirm(node);\n                }\n            },\n            buttons:{\n                confirm:{\n                    label:'Remove',\n                    className:'btn-danger'\n                }\n            }\n        });\n    }\n});\n\nvar OAuthAddonSettingsViewModel = oop.defclass({\n    constructor: function(name, displayName) {\n        var self = this;\n        self.name = name;\n        self.properName = displayName;\n        self.accounts = ko.observableArray();\n        self.message = ko.observable('');\n        self.messageClass = ko.observable('');\n    },\n    setMessage: function(msg, cls) {\n        var self = this;\n        self.message(msg);\n        self.messageClass(cls || 'text-info');\n    },\n    connectAccount: function() {\n        var self = this;\n        window.oauthComplete = function() {\n            self.setMessage('');\n            var accountCount = self.accounts().length;\n            self.updateAccounts().done( function() {\n                (self.accounts().length > accountCount) ?\n                    self.setMessage('Add-on successfully authorized. To link this add-on to an OSF project, go to the settings page of the project, enable ' + self.properName + ', and choose content to connect.', 'text-success') :\n                    self.setMessage('Error while authorizing addon. Please log in to your ' + self.properName + ' account and grant access to the OSF to enable this addon.', 'text-failure');\n                });\n        };\n        window.open('/oauth/connect/' + self.name + '/');\n    },\n    askDisconnect: function(account) {\n        var self = this;\n        bootbox.confirm({\n            title: 'Disconnect Account?',\n            message: '<p class=\"overflow\">' +\n                'Are you sure you want to disconnect the ' + self.properName + ' account <strong>' +\n                account.name + '</strong>? This will revoke access to ' + self.properName + ' for all projects you have authorized.' +\n                '</p>',\n            callback: function(confirm) {\n                if (confirm) {\n                    self.disconnectAccount(account);\n                    self.setMessage('');\n                }\n            },\n            buttons:{\n                confirm:{\n                    label:'Delete',\n                    className:'btn-danger'\n                }\n            }\n        });\n    },\n    disconnectAccount: function(account) {\n        var self = this;\n        var url = '/api/v1/oauth/accounts/' + account.id + '/';\n        var request = $.ajax({\n            url: url,\n            type: 'DELETE'\n        });\n        request.done(function(data) {\n            self.updateAccounts();\n        });\n        request.fail(function(xhr, status, error) {\n            Raven.captureMessage('Error while removing addon authorization for ' + account.id, {\n                url: url,\n                status: status,\n                error: error\n            });\n        });\n        return request;\n    },\n    updateAccounts: function() {\n        var self = this;\n        var url = '/api/v1/settings/' + self.name + '/accounts/';\n        var request = $.get(url);\n        request.done(function(data) {\n            self.accounts($.map(data.accounts, function(account) {\n                return new ExternalAccount(account);\n            }));\n        });\n        request.fail(function(xhr, status, error) {\n            Raven.captureMessage('Error while updating addon account', {\n                url: url,\n                status: status,\n                error: error\n            });\n        });\n        return request;\n    }\n});\n\nmodule.exports = {\n    ConnectedProject: ConnectedProject,\n    ExternalAccount: ExternalAccount,\n    OAuthAddonSettingsViewModel: OAuthAddonSettingsViewModel\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ../website/static/js/addonSettings.js\n ** module id = 196\n ** module chunks = 7 32\n **/","/**\n * Module for listing all projects/components authorized for a given addon\n * on the user settings page. Also handles revoking addon access from these\n * projects/components.\n */\n'use strict';\n\nvar $ = require('jquery');\nvar bootbox = require('bootbox');\n\nvar $osf = require('js/osfHelpers');\n\nvar AddonPermissionsTable = {\n    init: function(addonShortName, addonFullname) {\n        $('.' + addonShortName + '-remove-token').on('click', function (event) {\n            var nodeId = $(this).attr('node-id');\n            var apiUrl = $(this).attr('api-url')+ addonShortName + '/config/';\n            bootbox.confirm({\n                title: 'Remove addon?',\n                message: 'Are you sure you want to disconnnect the ' + addonFullname + ' account from this project?',\n                callback: function (confirm) {\n                    if (confirm) {\n                        $.ajax({\n                            type: 'DELETE',\n                            url: apiUrl,\n\n                            success: function (response) {\n\n                                $('#' + addonShortName + '-' + nodeId + '-auth-row').hide();\n                                var numNodes = $('#' + addonShortName + '-auth-table tr:visible').length;\n                                if (numNodes === 1) {\n                                    $('#' + addonShortName + '-auth-table').hide();\n                                }\n                                if (numNodes === 4) {\n                                    $('#' + addonShortName + '-more').hide();\n                                    $('#' + addonShortName+ '-less').hide();\n                                }\n                            },\n\n                            error: function () {\n                                $osf.growl('An error occurred, the account is still connected to the project. ',\n                                    'If the issue persists, please report it to <a href=\"mailto:support@osf.io\">support@osf.io</a>.');\n                            }\n                        });\n                    }\n                },\n                buttons:{\n                    confirm:{\n                        label:'Remove',\n                        className:'btn-danger'\n                    }\n                }\n            });\n        });\n    }\n};\n\nmodule.exports = AddonPermissionsTable;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ../website/static/js/addonPermissions.js\n ** module id = 384\n ** module chunks = 32\n **/"],"sourceRoot":""}